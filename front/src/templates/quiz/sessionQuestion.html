{% extends "base.html" %}
{% block title %}{% endblock %}
{% block description %}Сетевой тренажер для обучения компьютерным сетям{% endblock %}

{% block content %}
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//ajax.aspnetcdn.com/ajax/jquery.ui/1.10.3/jquery-ui.min.js"></script>

    <section class="container" style="margin-top: 48px; padding-top: 48px">
        {# Test name and section name #}
        <div class="row align-items-baseline">
            <div class="col-auto">
                <h1 class="mb-0" id="test_name">{{ test_name }}</h1>
            </div>
            <div class="col-auto text-center">
                <h3 class="mb-0" style="font-weight: normal" id="section_name">{{ section_name }}</h3>
            </div>
        </div>

        {# Timer, questions counter, finishQuiz button #}
        <div class="row align-items-baseline" style="margin: 8px 0 0 0; font-size: 24px; opacity: 85%">
            <div class="col-auto">
                <p id="counter"></p>
            </div>
            <div class="col-auto text-center">
                <span id="timer">00:00:00</span>
            </div>
            <div class="col-auto ms-auto" style="margin-bottom: 8px">
                <button name="finishQuiz" aria-label="Завершить тест" class="btn btn-outline-danger btn-icon me-5"
                        data-toggle="tooltip" data-bs-placement="right" title="Завершить тест">
                    <i class="bx bx-x fs-4 mx-1"></i>
                </button>
            </div>
        </div>
    </section>

    {% if question.question_type == "text" %}
        <article class="container card border-0 shadow-sm" style="padding: 12px 40px 12px 18px">
            {# Question text #}
            <div class="card-body p-1" style="margin-right: 40px">
                <p class="text-black m-0 px-4 py-3" id="question_text"
                   style="font-size: 24px">{{ question.question_text }}</p>

                {# Divider #}
                <div class="border border-1 border-success-subtle"></div>

                {# Answer area #}
                {% if question.question_type == "text" %}
                    <div class="container m-3" id="variants"></div>
                    <div class="container" id="explanation" hidden></div>
                {% endif %}
            </div>

            {# Control buttons #}
            <div class="card-body d-flex justify-content-end">
                <button name="answerQuestion" class="btn btn-primary">Ответить</button>
                <button name="nextQuestion" class="btn btn-primary" hidden>Следующий вопрос</button>
                <button name="seeResults" class="btn btn-primary" hidden>Посмотреть результаты</button>
            </div>
        </article>

        <script src="/quiz/text_question_scripts.js"></script>
        <script>
            const displayFunctions = {
                'variable': displayVariable,
                'matching': displayMatching,
                'sorting': displaySorting
            };
            const answers = '{{ question.answers | replace("'", '"') | safe }}';
            const textType = '{{ question.text_type }}';
            displayFunctions[textType](textType === 'sorting' ? answers.split(' ') : JSON.parse(answers));
        </script>
    {% endif %}

    <script src="/quiz/session_scripts.js"></script>
    <script>
        let finishSessionUrl = '{{ url_for('finish_session_endpoint') }}';
        let answerQuestionURL = '{{ url_for('answer_on_session_question_endpoint') }}';
        let getQuestionUrl = '{{ url_for('get_question_by_session_question_id_endpoint') }}';
        let sessionResultUrl = '{{ url_for('session_result_endpoint') }}';

        const questionType = '{{ question.question_type }}'
    </script>
{% endblock %}